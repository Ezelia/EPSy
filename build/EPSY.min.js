/*! EPSY v0.3.1 2014-10-12 */
var EPSY;!function(a){!function(a){!function(a){function b(a){return Math.PI*a/180}function c(a){return"number"==typeof a}function d(a){return a===(0|a)}function e(a,b){return Math.random()*(b-a)+a}function f(a,b){return Math.floor(Math.random()*(b-a+1)+a)}function g(a){var b=Math.sqrt(a.x*a.x+a.y*a.y);a.x/=b,a.y/=b}a.toRad=b,a.isNumber=c,a.isInteger=d,a.frandom=e,a.irandom=f,a.normalize=g}(a.math||(a.math={}));a.math}(a.utils||(a.utils={}));a.utils}(EPSY||(EPSY={}));var EPSY;!function(a){!function(a){!function(a){function b(a){var b={};return this.extend(b,a),b}function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])}function d(a,b,c){c=c||[];for(var d in b)b.hasOwnProperty(d)&&(c.indexOf(d)>-1?a[d]=b[d]:"object"==typeof b[d]?this.recursiveExtend(a[d],b[d],c):a[d]=b[d])}function e(a,b,c){if(c&&c.length&&!(c.length<=0))for(var d in b)c.indexOf(d)>=0&&("object"==typeof b[d]?(a[d]||(a[d]={}),this.recursiveExtend(a[d],b[d])):a[d]=b[d])}a.clone=b,a.extend=c,a.recursiveExtend=d,a.recursiveExtendInclusive=e}(a.obj||(a.obj={}));a.obj}(a.utils||(a.utils={}));a.utils}(EPSY||(EPSY={}));var EPSY;!function(a){a.EmitterParams=["id","border","duration","emissionRate","totalParticles","xFactor","aFactor","xEquation","yEquation","posTransform","zIndex"];var b=function(){function b(b){this.id=(1e20*Math.random()).toString(36),this.settings=new a.EmitterEntity,this.time=Date.now(),this._totalParticles=0,this.emissionRate=0,this.allOrNone=!1,this.aFactor={x:0,y:0},this.xFactor={x:0,y:0},this._xEqName="",this._yEqName="",this.active=!1,this.duration=0,this.cycles=1/0,this._particlePool=[],this._particleCount=0,this._particleIndex=0,this._elapsed=0,this._curCycle=0,this._emitCounter=0,this.border={top:100,left:100,bottom:100,right:100},this.recyclable=[],this._baseSystem=a.utils.obj.clone(b,["texture"]),this.load(b)}return Object.defineProperty(b.prototype,"zIndex",{get:function(){return this.container?this.container.__z||0:0},set:function(a){this.container&&(this.container.__z=~~a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"xEquation",{get:function(){return this._xEqName},set:function(a){"function"==typeof Math[a]?(this._xEqName=a,this._xEquation=Math[a]):(this._xEqName="",this._xEquation=void 0)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"yEquation",{get:function(){return this._yEqName},set:function(a){"function"==typeof Math[a]?(this._yEqName=a,this._yEquation=Math[a]):(this._yEqName="",this._yEquation=void 0)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"posTransform",{get:function(){if(!this._posTransform)return void 0;var a=this._posTransform.toString();return a.match(/[^{]+(.+)\}/g)[0]},set:function(a){this._posTransform="function"==typeof a?a:new Function("pos","particle",a)},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"particles",{get:function(){return this._particlePool},set:function(a){this._particlePool=a},enumerable:!0,configurable:!0}),Object.defineProperty(b.prototype,"totalParticles",{get:function(){return this._totalParticles},set:function(a){a=0|a,a!==this._totalParticles&&(this._totalParticles=a,this.restart())},enumerable:!0,configurable:!0}),b.prototype.load=function(b){this._totalParticles=0,this.emissionRate=0,this.active=!1,this.duration=0,this.settings.pos.x=0,this.settings.pos.y=0,this.settings.posVar.x=0,this.settings.posVar.y=0,this.settings.speed=0,this.settings.speedVar=0,this.settings.angle=0,this.settings.angleVar=0,this.settings.life=0,this.settings.lifeVar=0,this.settings.radius=0,this.settings.radiusVar=0,this.settings.texture=null,this.settings.textureAdditive=!1,this.settings.startScale=0,this.settings.startScaleVar=0,this.settings.endScale=0,this.settings.endScaleVar=0,this.settings.startColor[0]=0,this.settings.startColor[1]=0,this.settings.startColor[2]=0,this.settings.startColor[3]=0,this.settings.startColorVar[0]=0,this.settings.startColorVar[1]=0,this.settings.startColorVar[2]=0,this.settings.startColorVar[3]=0,this.settings.endColor[0]=0,this.settings.endColor[1]=0,this.settings.endColor[2]=0,this.settings.endColor[3]=0,this.settings.endColorVar[0]=0,this.settings.endColorVar[1]=0,this.settings.endColorVar[2]=0,this.settings.endColorVar[3]=0,this.settings.gravity.x=0,this.settings.gravity.y=0,this.settings.radialAccel=0,this.settings.radialAccelVar=0,this.settings.tangentialAccel=0,this.settings.tangentialAccelVar=0,a.utils.obj.recursiveExtend(this.settings,b,a.EmitterParams),a.utils.obj.recursiveExtendInclusive(this,b,a.EmitterParams),isNaN(this.duration)&&(this.duration=1/0),this.id=b.name||this.id,this.restart()},b.prototype.save=function(){var b=JSON.parse(JSON.stringify(this.settings));return a.utils.obj.recursiveExtendInclusive(b,this,a.EmitterParams),b},b.prototype.restart=function(){if(this._particlePool.length<this.totalParticles)for(var b=this._particlePool.length;b<this.totalParticles;++b)this._particlePool.push(new a.Particle);if(this._particlePool.length>this.totalParticles){var c=this._particlePool.splice(this.totalParticles);this.recyclable=this.recyclable.concat(c)}for(var b=0;b<this.totalParticles;++b){var d=this._particlePool[b];d.recycled=!0}this._particleCount=0,this._particleIndex=0,this._elapsed=0,this._curCycle=0,this._emitCounter=0},b.prototype.reset=function(){this.load(this._baseSystem)},b.prototype._isFull=function(){return this._particleCount===this.totalParticles},b.prototype.createParticle=function(){if(this._isFull())return!1;var a=this._particlePool[this._particleCount];return this.initParticle(a),this._particleCount++,!0},b.prototype.initParticle=function(b){b.texture=this.settings.texture,b.textureAdditive=this.settings.textureAdditive;var c={x:this.settings.posVar.x*a.utils.math.frandom(-1,1),y:this.settings.posVar.y*a.utils.math.frandom(-1,1)};this._posTransform&&(c=this._posTransform.call(this,c,b)),b.pos.x=this.settings.pos.x+c.x,b.pos.y=this.settings.pos.y+c.y;var d=this.settings.angle+this.settings.angleVar*a.utils.math.frandom(-1,1),e=this.settings.speed+this.settings.speedVar*a.utils.math.frandom(-1,1);b.setVelocity(d,e),b.radialAccel=this.settings.radialAccel+this.settings.radialAccelVar*a.utils.math.frandom(-1,1)||0,b.tangentialAccel=this.settings.tangentialAccel+this.settings.tangentialAccelVar*a.utils.math.frandom(-1,1)||0;var f=this.settings.life+this.settings.lifeVar*a.utils.math.frandom(-1,1)||0;if(b.life=Math.max(0,f),b.scale=a.utils.math.isNumber(this.settings.startScale)?this.settings.startScale:1,b.deltaScale=a.utils.math.isNumber(this.settings.endScale)?this.settings.endScale-this.settings.startScale:0,b.deltaScale/=b.life,b.radius=a.utils.math.isNumber(this.settings.radius)?this.settings.radius+(this.settings.radiusVar||0)*a.utils.math.frandom(-1,1):0,this.settings.startColor){var g=[this.settings.startColor[0]+this.settings.startColorVar[0]*a.utils.math.frandom(-1,1),this.settings.startColor[1]+this.settings.startColorVar[1]*a.utils.math.frandom(-1,1),this.settings.startColor[2]+this.settings.startColorVar[2]*a.utils.math.frandom(-1,1),this.settings.startColor[3]+this.settings.startColorVar[3]*a.utils.math.frandom(-1,1)],h=g;this.settings.endColor&&(h=[this.settings.endColor[0]+this.settings.endColorVar[0]*a.utils.math.frandom(-1,1),this.settings.endColor[1]+this.settings.endColorVar[1]*a.utils.math.frandom(-1,1),this.settings.endColor[2]+this.settings.endColorVar[2]*a.utils.math.frandom(-1,1),this.settings.endColor[3]+this.settings.endColorVar[3]*a.utils.math.frandom(-1,1)]),b.color=g,b.deltaColor=[(h[0]-g[0])/b.life,(h[1]-g[1])/b.life,(h[2]-g[2])/b.life,(h[3]-g[3])/b.life];for(var i=0;3>i;i++)b.startColor[i]=~~b.startColor[i],b.endColor[i]=~~b.endColor[i],b.deltaColor[i]=~~b.deltaColor[i]}},b.prototype.updateParticle=function(b,c,d){var e=!this.border||b.pos.x>=this.settings.pos.x-this.border.left&&b.pos.y>=this.settings.pos.y-this.border.top&&b.pos.x<=this.settings.pos.x+this.border.right&&b.pos.y<=this.settings.pos.y+this.border.bottom;if(e||(b.life=0),b.life>0){b.radial.x=0,b.radial.y=0,b.forces.x=0,b.forces.y=0,b.pos.x===this.settings.pos.x&&b.pos.y===this.settings.pos.y||!b.radialAccel&&!b.tangentialAccel||(b.radial.x=b.pos.x-this.settings.pos.x,b.radial.y=b.pos.y-this.settings.pos.y,a.utils.math.normalize(b.radial)),b.tangential.x=b.radial.x,b.tangential.y=b.radial.y,b.radial.x*=b.radialAccel,b.radial.y*=b.radialAccel;var f=b.tangential.x;b.tangential.x=-b.tangential.y,b.tangential.y=f,b.tangential.x*=b.tangentialAccel,b.tangential.y*=b.tangentialAccel,b.forces.x=b.radial.x+b.tangential.x+this.settings.gravity.x,b.forces.y=b.radial.y+b.tangential.y+this.settings.gravity.y,b.forces.x*=c,b.forces.y*=c,b.vel.x+=b.forces.x,b.vel.y+=b.forces.y,b.lastpos.x=b.pos.x,b.lastpos.y=b.pos.y;var g=0,h=0;this._xEquation&&(g=this.aFactor.x*this._xEquation(b.life*this.xFactor.x*Math.PI)),this._yEquation&&(h=this.aFactor.y*this._yEquation(b.life*this.xFactor.y*Math.PI)),b.pos.x+=b.vel.x*c+g,b.pos.y+=b.vel.y*c+h,b.life-=c,b.scale+=b.deltaScale*c,b.color&&(this.settings.colorList.length>0?(b.color[0]=this.settings.colorList[b.colorIdx][0],b.color[1]=this.settings.colorList[b.colorIdx][1],b.color[2]=this.settings.colorList[b.colorIdx][2],b.color[3]=this.settings.colorList[b.colorIdx][3],b.colorIdx++,b.colorIdx>=this.settings.colorList.length&&(b.colorIdx=0)):(b.color[0]+=b.deltaColor[0]*c,b.color[1]+=b.deltaColor[1]*c,b.color[2]+=b.deltaColor[2]*c,b.color[3]+=b.deltaColor[3]*c)),++this._particleIndex}else{b.color[3]=0;var i=this._particlePool[d];this._particlePool[d]=this._particlePool[this._particleCount-1],this._particlePool[this._particleCount-1]=i,--this._particleCount}},b.prototype.kill=function(){for(var a=0;a<this._particlePool.length;a++){var b=this._particlePool[a];b.life=0}this._particlePool=[],this.duration=-1,this._particleCount=0,this._particleIndex=0,this._elapsed=0,this._emitCounter=0},b.prototype.update=function(a){if(this._elapsed+=a,this.active=this._elapsed<this.duration,this.active){if(this.emissionRate){var b=1/this.emissionRate;if(this._emitCounter+=a,this.allOrNone){if(0==this._particleCount&&this._curCycle<this.cycles){for(;!this._isFull();)this.createParticle();this._curCycle++}}else for(;!this._isFull()&&this._emitCounter>b;)this.createParticle(),this._emitCounter-=b}for(this._particleIndex=0;this._particleIndex<this._particleCount;){var c=this._particlePool[this._particleIndex];this.updateParticle(c,a,this._particleIndex)}}},b}();a.Emitter=b}(EPSY||(EPSY={}));var EPSY;!function(a){var b=function(){function a(){this.pos={x:0,y:0},this.posVar={x:0,y:0},this.speed=0,this.speedVar=0,this.angle=0,this.angleVar=0,this.life=0,this.lifeVar=0,this.radius=0,this.radiusVar=0,this.textureAdditive=!1,this.startScale=0,this.startScaleVar=0,this.endScale=0,this.endScaleVar=0,this.startColor=[0,0,0,0],this.startColorVar=[0,0,0,0],this.endColor=[0,0,0,0],this.endColorVar=[0,0,0,0],this.colorList=[],this.gravity={x:0,y:0},this.radialAccel=0,this.radialAccelVar=0,this.tangentialAccel=0,this.tangentialAccelVar=0}return a}();a.EmitterEntity=b}(EPSY||(EPSY={}));var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},EPSY;!function(a){var b=function(b){function c(){b.call(this),this.lastpos={x:-1,y:-1},this.vel={x:0,y:0},this.forces={x:0,y:0},this.radial={x:0,y:0},this.tangential={x:0,y:0},this.colorIdx=0,this.recycled=!1,this.setVelocity(0,0)}return __extends(c,b),c.prototype.setVelocity=function(b,c){this.vel.x=Math.cos(a.utils.math.toRad(b))*c,this.vel.y=-Math.sin(a.utils.math.toRad(b))*c},c}(a.EmitterEntity);a.Particle=b}(EPSY||(EPSY={}));var EPSY;!function(a){function b(a,b){var c=0|a[0],d=0|a[1],e=0|a[2],f=b||a[3];return"rgba("+c+", "+d+", "+e+", "+f+")"}function c(a){var b=a.img;if(b||(b=new Image,a.ready=!1,b.onload=function(){a.ready=!0},b.src=a.texture,a.img=b),!a.ready)return void 0;var c=""+b.width+"x"+b.height,e=d[c];return e||(e=document.createElement("canvas"),e.width=b.width,e.height=b.height,d[c]=e),e}var d={},e=function(){function a(a){this.context=a,this.defaultTexture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACz0lEQVR42t2XP0hbURTGnfp/KK3QFiylCG11aRYpBQWFDiJCg266BNQtdnBQyOASQjp1KS4KGVw6iXMWEUdHUShkCBhSQpaQkJg/Jmm/H3xLEdtaWvLawMfJvfec79x77jnnvdfX96/9MpnM9VwudzOfz98qFAq3kYyZ/6tOi8XinVKpdLdSqfRXq9UHwsNarfYIyZh51tH7Y5s5Pj6+BqHI7+OsXq8/aTQag8LzZrM5JAwjGTPPOnroY4f9bzvPZrM3OBEnFPFTOXohvGy1WiPC6/Pz81FhDMmYedbRQx877OG5snPutFwu3zs7OxvQyZ6JPGSnE8KkMN1ut98KYSRjz094MyHssIcHviud3M4fE15OJuJxOZoSZoU5ISIsCIuWEc+zPoW+IzIED3y/FAnujLCxczt/JbI3Pum8sCQsCyudTmdVWEMy9vyS9cLYYe9NDMD705wgcbg7h33Ezmd8wqidrgtxISm8t4x7ns1ErT/jTYzABy/8Pyw1spcE4g4d9rDJ3ok8JiSED8KGsClsWW54nvUY+rYL+zpC8MJ/aYmyO0qILCaRfOfzPnnMJ/0opIRPwk63291FepzyetKbiNp+Cj544b80CtwRdUwpkc1OqCWHPWHybTtNS+5LHlimPb9tvYSvg5yYhQ9e+PFzWfj7aSa++0ln9bLvlvCm7GRP8lDySDhBerzn9ZT1152Yc/A5Fwbxc+EaqFPaKR3N9T7tO1xxgm04zJz0UPis/6fCFyRjbyJtPfTjro4IfPDCj58LfYEHCllKydDZ3GQWHP6kE23H4T6y05Jk1fLUkdh3TmzabtV9gmY1Cj9+8PfdBniqOQGHaa/O/kXXOaW25fAeOOycvPpVP6THJ86JXVcHdmtuVlTDGPz4wV+wItDzHOh5FfS8DwSiE/b8WdDzp2Eg3gd6/kYUiHfCQLwVB+K7IBBfRoH5Nvyvf98A3rZr7fen7G8AAAAASUVORK5CYII="}return a.prototype.renderParticle=function(a){if(a.texture||(a.texture=this.defaultTexture),a.buffer=a.buffer||c(a),a.buffer){var d=a.buffer.getContext("2d"),e=a.img.width*a.scale|0,f=a.img.height*a.scale|0,g=a.pos.x-e/2,h=a.pos.y-f/2;d.clearRect(0,0,a.buffer.width,a.buffer.height),d.globalAlpha=a.color[3],d.drawImage(a.img,0,0),d.globalCompositeOperation="source-atop",d.fillStyle=b(a.color,1),d.fillRect(0,0,a.buffer.width,a.buffer.height),d.globalCompositeOperation="source-over",d.globalAlpha=1,this.context.globalCompositeOperation=a.textureAdditive?"lighter":"source-over",this.context.drawImage(a.buffer,0,0,a.buffer.width,a.buffer.height,g,h,e,f)}},a.prototype.render=function(a){for(var b=a.particles,c=0;c<b.length;++c){var d=b[c];d.life>0&&d.color&&this.renderParticle(d)}this.context.globalCompositeOperation="source-over"},a.prototype.reset=function(){},a}();a.CanvasRenderer=e}(EPSY||(EPSY={}));var EPSY;!function(a){var b=function(){function a(a){this.context=a,this.defaultTexture="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACz0lEQVR42t2XP0hbURTGnfp/KK3QFiylCG11aRYpBQWFDiJCg266BNQtdnBQyOASQjp1KS4KGVw6iXMWEUdHUShkCBhSQpaQkJg/Jmm/H3xLEdtaWvLawMfJvfec79x77jnnvdfX96/9MpnM9VwudzOfz98qFAq3kYyZ/6tOi8XinVKpdLdSqfRXq9UHwsNarfYIyZh51tH7Y5s5Pj6+BqHI7+OsXq8/aTQag8LzZrM5JAwjGTPPOnroY4f9bzvPZrM3OBEnFPFTOXohvGy1WiPC6/Pz81FhDMmYedbRQx877OG5snPutFwu3zs7OxvQyZ6JPGSnE8KkMN1ut98KYSRjz094MyHssIcHviud3M4fE15OJuJxOZoSZoU5ISIsCIuWEc+zPoW+IzIED3y/FAnujLCxczt/JbI3Pum8sCQsCyudTmdVWEMy9vyS9cLYYe9NDMD705wgcbg7h33Ezmd8wqidrgtxISm8t4x7ns1ErT/jTYzABy/8Pyw1spcE4g4d9rDJ3ok8JiSED8KGsClsWW54nvUY+rYL+zpC8MJ/aYmyO0qILCaRfOfzPnnMJ/0opIRPwk63291FepzyetKbiNp+Cj544b80CtwRdUwpkc1OqCWHPWHybTtNS+5LHlimPb9tvYSvg5yYhQ9e+PFzWfj7aSa++0ln9bLvlvCm7GRP8lDySDhBerzn9ZT1152Yc/A5Fwbxc+EaqFPaKR3N9T7tO1xxgm04zJz0UPis/6fCFyRjbyJtPfTjro4IfPDCj58LfYEHCllKydDZ3GQWHP6kE23H4T6y05Jk1fLUkdh3TmzabtV9gmY1Cj9+8PfdBniqOQGHaa/O/kXXOaW25fAeOOycvPpVP6THJ86JXVcHdmtuVlTDGPz4wV+wItDzHOh5FfS8DwSiE/b8WdDzp2Eg3gd6/kYUiHfCQLwVB+K7IBBfRoH5Nvyvf98A3rZr7fen7G8AAAAASUVORK5CYII=",this.buffer=[],this._sortFn=function(a,b){return(a.__z||0)-(b.__z||0)}}return a.prototype.updateParticleSprite=function(a,b){if(b.life<=0&&b.sprite)return void(b.sprite.visible=!1);if(!b.sprite||b.recycled){var c=PIXI.Texture.fromImage(b.texture||this.defaultTexture);b.recycled&&b.sprite?b.sprite.texture=c:b.sprite=new PIXI.Sprite(c),b.sprite.__parentParticle=b,b.sprite.anchor.x=.5,b.sprite.anchor.y=.5,b.sprite.tail=0}b.inserted||(b.inserted=!0,this.buffer.push(b.sprite),a.container.addChild(b.sprite)),b.sprite.visible=b.life>0,b.sprite.width=b.radius*b.scale,b.sprite.height=b.radius*b.scale,b.sprite.position.x=b.pos.x,b.sprite.position.y=b.pos.y,b.sprite.blendMode=b.textureAdditive?PIXI.blendModes.ADD:PIXI.blendModes.NORMAL,b.sprite.tint=~~b.color[2]+256*~~b.color[1]+65536*~~b.color[0],b.sprite.alpha=b.color[3]},a.prototype.render=function(a){var b=a.particles;a.container||(a.container=new PIXI.DisplayObjectContainer,this.context.addChild(a.container));for(var c=0;c<b.length;++c){var d=b[c];d.color&&this.updateParticleSprite(a,d)}if(a.recyclable.length>0)for(var e;e=a.recyclable.pop();)e.life=0,e.sprite&&(e.sprite.visible=!1,e.sprite.__parentParticle&&(e.sprite.__parentParticle.inserted=!1))},a.prototype.hideAllParticles=function(a){for(var b=0;b<a.particles.length;b++){var c=a.particles[b];c.life=0}},a.prototype.sort=function(){this.context.children.sort(this._sortFn)},a.prototype.reset=function(){var a=0;do{var b=this.buffer.pop();if(b){for(var c=0;c<this.context.children.length;c++){var d=this.context.children[c];if(d)try{d.removeChild(b),a++;continue}catch(e){}}b.__parentParticle&&(b.__parentParticle.inserted=!1,b.__parentParticle.life=0)}}while(this.buffer.length>0);console.log("reset particles = ",a)},a}();a.PixiRenderer=b}(EPSY||(EPSY={}));